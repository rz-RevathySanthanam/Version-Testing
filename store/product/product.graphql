fragment baseProductCardFields on ProductInterface {
  __typename
  canonical_url
  categories {
    name
    id
    uid
    url_key
    url_path
    url_suffix
  }
  image {
    disabled
    label
    position
    url
  }
  name
  new
  special_from_date
  price_range {
    maximum_price {
      discount {
        amount_off
        percent_off
      }
      final_price {
        currency
        value
      }
      fixed_product_taxes {
        amount {
          currency
          value
        }
        label
      }
      regular_price {
        currency
        value
      }
    } 
    minimum_price {
      discount {
        amount_off
        percent_off
      }
      final_price {
        currency
        value
      }
      fixed_product_taxes {
        amount {
          currency
          value
        }
        label
      }
      regular_price {
        currency
        value
      }
    } 
  }
  price_tiers {
    discount {
      amount_off
      percent_off
    }
    final_price {
      value
      currency
    }
    quantity
  }
  special_price
  special_to_date
  stock_status
  sale
  uid
  sku
  id
  url_key
  url_suffix
  # video_file
  short_description {
    html
  }

  crosssell_products {
    uid
    sku
    url_key
    name
    new
    url_suffix
    canonical_url
    url_suffix
    stock_status
    image {
      disabled
      url
    }

    special_from_date
    price_range {
      minimum_price {
        final_price {
          currency
          value
        }
      }
    }
  }
}

fragment customizableProductFields on CustomizableProductInterface {
  options{
    required
    sort_order
    title
    uid
    type: __typename
    ... on CustomizableAreaOption {
      areaOption: value {
        uid
        price
        price_type,
        max_characters
      }
    }

    ... on CustomizableDateOption  {
      dateOption: value {
        uid
        price
        price_type
      }
    }

    ... on CustomizableDropDownOption {
      dropdownOption: value {
        uid
        price
        price_type,
        sort_order,
        title,
        option_type_id
      }
    }

    ... on  CustomizableMultipleOption {
      multipleOption: value {
        uid
        price
        price_type,
        sort_order,
        title,
        option_type_id
      }
    }

    ... on  CustomizableFieldOption {
      fieldOption: value {
        uid
        price
        price_type,
        max_characters,
      }
    }
    ... on  CustomizableRadioOption  {
      radionOption: value {
        uid
        price
        price_type,
        sort_order,
        title,
        option_type_id
      }
    }
    ... on  CustomizableCheckboxOption {
      checkboxOption: value {
        uid
        price
        price_type,
        sort_order,
        title,
        option_type_id
      }
    }
  }
}

fragment virtualProductFields on VirtualProduct {
  ...customizableProductFields
}

fragment simpleProductFields on SimpleProduct {
  weight
  ...customizableProductFields
}

fragment downloadableProductFields on DownloadableProduct {
  ...customizableProductFields
  
  downloadable_product_links {
    price
    sample_url
    sort_order
    title
    uid
  } 
	
  downloadable_product_samples {
    sample_url
    sort_order
    title
  }
}

fragment bundleProductFields on BundleProduct {
  weight
  ...customizableProductFields
  ship_bundle_items
  dynamic_sku
  dynamic_price
  dynamic_weight
  price_view
  items {
    position
    required
    sku
    title
    type
    uid
    options{
      can_change_quantity
      is_default
      label
      position
      price
      price_type
      quantity
      uid
      product {
        uid
        name
        sku
        url_key,
        special_from_date
        price_range {
          maximum_price {
            discount {
              amount_off
              percent_off
            }
            final_price {
              currency
              value
            }
            fixed_product_taxes {
              amount {
                currency
                value
              }
              label
            }
            regular_price {
              currency
              value
            }
          } 
          minimum_price {
            discount {
              amount_off
              percent_off
            }
            final_price {
              currency
              value
            }
            fixed_product_taxes {
              amount {
                currency
                value
              }
              label
            }
            regular_price {
              currency
              value
            }
          } 
        }
        price_tiers {
          discount {
            amount_off
            percent_off
          }
          final_price {
            value
            currency
          }
          quantity
        }
      }
    }
  }
}

fragment groupedProductFields on GroupedProduct {
  weight
  items {
    position
    qty
    product {
      uid
      name
      sku
      url_key,
      special_from_date
      price_range {
        maximum_price {
          discount {
            amount_off
            percent_off
          }
          final_price {
            currency
            value
          }
          fixed_product_taxes {
            amount {
              currency
              value
            }
            label
          }
          regular_price {
            currency
            value
          }
        } 
        minimum_price {
          discount {
            amount_off
            percent_off
          }
          final_price {
            currency
            value
          }
          fixed_product_taxes {
            amount {
              currency
              value
            }
            label
          }
          regular_price {
            currency
            value
          }
        } 
      }
    }
  }
}

fragment configurableProductFields on ConfigurableProduct {
  weight
  ...customizableProductFields
  configurable_options {
    attribute_code
    attribute_uid
    id
    label
    position
    uid
    use_default
    values {
      default_label
      label
      store_label
      swatch_data {
        value
      }
      uid
      use_default_value
    }
  }
}

fragment filterAggregationFields on Aggregation {
  attribute_code
  count
  label
  options {
    count
    label
    value
  }
}

fragment filterPageFields on SearchResultPageInfo {
  current_page
  page_size
  total_pages
}

fragment filterSortFields on SortFields {
  default
  options {
    label
    value
  } 
}

query ProductsFilterQuery(
  $searchText: String,
  $filterQuery: ProductAttributeFilterInput,
  $sortQuery: ProductAttributeSortInput,
  $currentPage: Int,
  $pageSize: Int) {
  products(search: $searchText, filter: $filterQuery, sort: $sortQuery, currentPage:$currentPage, pageSize: $pageSize) {
    items {
      ...baseProductCardFields
      ... on VirtualProduct {
        ...virtualProductFields
      }
      
      ... on SimpleProduct {
        ...simpleProductFields
      }
      
      ... on DownloadableProduct {
        ...downloadableProductFields
      }
      
      ... on BundleProduct {
        ...bundleProductFields
      }
      
      ... on GroupedProduct {
        ...groupedProductFields
      }
      
      ... on ConfigurableProduct {
        ...configurableProductFields
      }
    }
    aggregations {
      ...filterAggregationFields
    }
    page_info {
      ...filterPageFields
    }
    sort_fields {
      ...filterSortFields
    }
    total_count
  }
}

query ProductCardListQuery($urlKeys: [String!]) {
  products(
    filter: {
      url_key: {
        in: $urlKeys
      }
    }
  ) {
    items {
      ...baseProductCardFields      
      ... on VirtualProduct {
        ...virtualProductFields
      }
      
      ... on SimpleProduct {
        ...simpleProductFields
      }
      
      ... on DownloadableProduct {
        ...downloadableProductFields
      }
      
      ... on BundleProduct {
        ...bundleProductFields
      }
      
      ... on GroupedProduct {
        ...groupedProductFields
      }
      
      ... on ConfigurableProduct {
        ...configurableProductFields
      }

    }
  }
}